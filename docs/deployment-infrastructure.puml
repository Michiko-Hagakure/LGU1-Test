@startuml Deployment and Infrastructure
!define ICONURL https://raw.githubusercontent.com/tupadr3/plantuml-icon-font-sprites/v2.4.0
!include ICONURL/common.puml
!include ICONURL/font-awesome-5/server.puml
!include ICONURL/font-awesome-5/database.puml
!include ICONURL/font-awesome-5/cloud.puml
!include ICONURL/font-awesome-5/shield_alt.puml
!include ICONURL/font-awesome-5/hdd.puml

title Deployment and Infrastructure\nLGU1 Public Facilities Reservation System

skinparam defaultTextAlignment center
skinparam componentStyle rectangle
skinparam linetype ortho

' Production Environment
package "Production Environment" {
    
    ' Load Balancer / Reverse Proxy
    node "Reverse Proxy\n(Nginx/Apache)" as proxy #FF6B6B {
        component "SSL/TLS\nTermination" as ssl
        component "Load Balancer" as lb
    }
    
    ' Application Servers
    package "Application Tier" {
        node "Web Server 1\n(Laravel + PHP 8.1)" as app1 #4ECDC4 {
            component "Laravel App" as laravel1
            component "Vite Assets" as vite1
        }
        
        node "Web Server 2\n(Laravel + PHP 8.1)" as app2 #4ECDC4 {
            component "Laravel App" as laravel2
            component "Vite Assets" as vite2
        }
    }
    
    ' Database Tier
    package "Database Tier" {
        database "Primary DB Server\nMySQL 8.0" as db_primary #95E1D3 {
            storage "lgu1_auth\n(Authentication)" as auth_db
            storage "lgu1_facilities\n(Reservations)" as facilities_db
        }
        
        database "Replica DB Server\nMySQL 8.0" as db_replica #A8E6CF {
            storage "lgu1_auth\n(Read Replica)" as auth_replica
            storage "lgu1_facilities\n(Read Replica)" as facilities_replica
        }
    }
    
    ' Cache Layer
    node "Cache Server\n(Optional)" as cache #FFE66D {
        storage "Redis/Memcached" as redis
    }
    
    ' Queue Server
    node "Message Queue\nRabbitMQ" as mq #FFA07A {
        component "Email Queue" as email_queue
        component "Notification Queue" as notif_queue
        component "Backup Queue" as backup_queue
    }
    
    ' File Storage
    storage "File Storage\n(Local/NAS)" as storage #C7CEEA {
        folder "Backups\n(AES-256 Encrypted)" as backup_storage
        folder "Uploads\n(Documents, IDs)" as upload_storage
        folder "Assets\n(Images, PDFs)" as asset_storage
    }
}

' External Services
cloud "External Services" as external_cloud #E0E0E0 {
    rectangle "PayMongo\nPayment Gateway" as paymongo #87CEEB
    rectangle "SMTP Server\n(Email Delivery)" as smtp #90EE90
}

' Monitoring & Backup
package "Management & Monitoring" {
    node "Backup Server" as backup_server #FFDAB9 {
        component "Automated Backup\nSpatie Laravel Backup" as backup_tool
    }
    
    node "Monitoring Dashboard" as monitoring #E6E6FA {
        component "Laravel Telescope" as telescope
        component "Server Monitoring" as server_mon
        component "Log Aggregation" as logs
    }
}

' Client Layer
actor "Citizens" as citizens
actor "Admin/Staff" as staff
actor "Treasurer" as treasurer

' Connections - Client to Proxy
citizens -down-> proxy : "HTTPS\n(Port 443)"
staff -down-> proxy : "HTTPS\n(Port 443)"
treasurer -down-> proxy : "HTTPS\n(Port 443)"

' Connections - Proxy to Apps
proxy -down-> lb
lb -down-> app1 : "HTTP\n(Internal)"
lb -down-> app2 : "HTTP\n(Internal)"

' Connections - Apps to Database
app1 -down-> db_primary : "MySQL\n(Port 3306)\nRead/Write"
app2 -down-> db_primary : "MySQL\nRead/Write"

app1 ..> db_replica : "Read-Only\nQueries"
app2 ..> db_replica : "Read-Only\nQueries"

' Database Replication
db_primary -right-> db_replica : "Replication\n(Async)"

' Connections - Apps to Cache
app1 ..> cache : "Cache\nRead/Write"
app2 ..> cache : "Cache\nRead/Write"

' Connections - Apps to Queue
app1 -down-> mq : "AMQP\nProtocol"
app2 -down-> mq : "AMQP\nProtocol"

' Connections - Apps to Storage
app1 -right-> storage : "File I/O"
app2 -right-> storage : "File I/O"

' Connections - Apps to External Services
app1 ..> paymongo : "REST API\nHTTPS"
app2 ..> paymongo : "REST API\nHTTPS"

mq -right-> smtp : "SMTP\n(Port 587)"

' Backup Connections
backup_server -up-> db_primary : "Backup\nScheduled"
backup_server -right-> backup_storage : "Store\nEncrypted"

' Monitoring Connections
monitoring -up-> app1 : "Collect Metrics"
monitoring -up-> app2 : "Collect Metrics"
monitoring ..> db_primary : "Query Performance"

' Notes
note right of proxy
  **Security Layer:**
  • SSL/TLS Certificates
  • DDoS Protection
  • Rate Limiting
  • CSRF Protection
end note

note right of db_primary
  **Database Features:**
  • Master-Replica Setup
  • Automated Backups
  • Transaction Logging
  • Query Optimization
end note

note bottom of storage
  **Storage Features:**
  • Daily Backups (7-day retention)
  • AES-256 Encryption
  • Access Control
  • 5GB Limit
end note

note left of mq
  **Queue Processing:**
  • Async Email Sending
  • Payment Notifications
  • Backup Tasks
  • Retry Logic
end note

' Legend
legend right
  |= Component |= Purpose |
  | Web Servers | Laravel application instances |
  | Database | MySQL master-replica setup |
  | Cache | Optional Redis for sessions |
  | Message Queue | RabbitMQ for async tasks |
  | File Storage | Local/NAS for uploads & backups |
  | External | PayMongo, SMTP services |
  
  |= Connection Type |
  | Solid Line | Primary data flow |
  | Dotted Line | Optional/Secondary |
endlegend

@enduml
